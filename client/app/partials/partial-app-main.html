<div class="navbar navbar-inverse">
  <h3 class="header-text">Main</h3>
</div>

<div class="content-body">
  <a ng-click="isRecentGoalsClosed = !isRecentGoalsClosed">
    <legend class="section-toggle">Recent Goals</legend>
  </a>
  <div class="goal panel panel-default" uib-collapse="isRecentGoalsClosed"
    ng-repeat="goal in user.goals | orderBy:'-updatedAt' | limitTo:3">
    <div class="panel-heading">
      <div class="row">
        <div class="col-md-8">Goal: {{goal.title}}</div>
        <div class="col-md-4">
          <span class="date">
            Updated <span am-time-ago="goal.updatedAt">{{goal.updatedAt}}</span>
          </span>
        </div>
      </div>
    </div>
    <div class="alert" ng-class="{true: 'alert-danger', false: 'alert-success'}[goal.warn]">
      <div class="row">
        <label class="col-md-2">Status:</label>
        <div class="col-md-10">{{goal.status}}</div>
      </div>
      <div class="row">
        <label class="col-md-2">Due Date:</label>
        <div class="col-md-10">{{goal.due_date | amCalendar}}</div>
      </div>
      <div class="row">
        <label class="col-md-2">Latest Post:</label>
        <div class="col-md-10" ng-repeat="post in goal.posts | orderBy:'-updatedAt' | limitTo:1">
          {{post.post}}</div>
      </div>
    </div>
  </div>

  <div class="panel panel-default">
    <form class="panel-body" ng-submit="addPost()">
      <div class="row">
        <label class="col-md-2 control-label" for="goalSelect">Goal to Update:</label>
        <div class="col-md-8">
          <select class="form-control" id="goalSelect" ng-model="input.selected"
            ng-options="goal.title for goal in user.goals track by goal._id">
          </select>
        </div>
      </div>
      <br>
      <div class="row">
        <div class="col-md-10">
          <input class="form-control" type="text" ng-model="input.post"
            placeholder="Any progress lately? Share an update!">
        </div>
        <div class="col-md-2">
          <input class="btn btn-primary" type="submit" value="Add Post" />
        </div>
      </div>
    </form>
  </div>

  <legend>Inactive Friends Activity</legend>
  <ul>
    <li ng-repeat="friend in friends | filter:search | orderBy:'lastname'">
      <div class="friend">
        <a class="name" ui-sref="app.viewfriend({ friendID: friend.auth_id })" class="name">{{friend.firstname}} {{friend.lastname}} {{friend.username}}</a>
        <span>Your friend's last update was </span><span am-time-ago="friend.latestPost.updatedAt">{{friend.latestPost.updatedAt}}</span><span>.</span>
        <div>
          <span class="message">Status: {{friend.status}}</span>
        </div>
        <div class="latestPost">
          <span class="goalTitle">{{friend.latestPost.goalTitle}}</span>
          <span class="goalPost">{{friend.latestPost.post}}</span>
        </div>
      </div>
    </li>
  </ul>
  <legend>All Activity</legend>
  <ul>
    <li ng-repeat="post in posts | filter:search | orderBy:'-updatedAt'">
      <div class="friend">
        <a class="name" ui-sref="app.viewfriend({ friendID: post.friend.auth_id })" class="name">{{post.friend.firstname}} {{post.friend.lastname}} {{post.friend.username}}</a>
        <span>Posted </span><span am-time-ago="post.updatedAt">{{post.updatedAt}}</span><span>.</span>
        <div class="latestPost">
          <span class="goalTitle">{{post.goalTitle}}</span>
          <span class="goalPost">{{post.post}}</span>
          <ul>
            <li ng-repeat="comment in post.comments | orderBy:'-updatedAt'">
              <div class="comment">
                <div>{{comment.firstname}} {{comment.lastname}}<p>{{comment.comment}}</p></div>
                <span class="date" am-time-ago="comment.createdAt">{{post.createdAt}}</span>
              </div>
            </li>
          </ul>
          <a class="addComment" ng-click="isAddCommentClosed = !isAddCommentClosed">Add comment?</a>
          <form ng-show="isAddCommentClosed"
            ng-submit="addComment(post._id, post.goal_id, input.comment[$index], post.friend.auth_id);
              input.comment[$index] = ''; ">
            <br>
            <input type="text" placeholder="Write comment here..." ng-model="input.comment[$index]">
            <input type="submit" value="Submit" />
            <br>
          </form>
        </div>
      </div>
    </li>
  </ul>
</div>